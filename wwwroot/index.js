(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();let ce=j;const C=1,S=2,Y={owned:null,cleanups:null,context:null,owner:null};var h=null;let I=null,ae=null,g=null,u=null,x=null,N=0;function fe(s,e){const t=g,n=h,o=s.length===0,r=e===void 0?n:e,i=o?Y:{owned:null,cleanups:null,context:r?r.context:null,owner:r},l=o?s:()=>s(()=>E(()=>B(i)));h=i,g=null;try{return R(l,!0)}finally{g=t,h=n}}function P(s,e,t){const n=ue(s,e,!1,C);$(n)}function E(s){if(g===null)return s();const e=g;g=null;try{return s()}finally{g=e}}function de(s,e,t){let n=s.value;return(!s.comparator||!s.comparator(n,e))&&(s.value=e,s.observers&&s.observers.length&&R(()=>{for(let o=0;o<s.observers.length;o+=1){const r=s.observers[o],i=I&&I.running;i&&I.disposed.has(r),(i?!r.tState:!r.state)&&(r.pure?u.push(r):x.push(r),r.observers&&q(r)),i||(r.state=C)}if(u.length>1e6)throw u=[],new Error},!1)),e}function $(s){if(!s.fn)return;B(s);const e=N;he(s,s.value,e)}function he(s,e,t){let n;const o=h,r=g;g=h=s;try{n=s.fn(e)}catch(i){return s.pure&&(s.state=C,s.owned&&s.owned.forEach(B),s.owned=null),s.updatedAt=t+1,X(i)}finally{g=r,h=o}(!s.updatedAt||s.updatedAt<=t)&&(s.updatedAt!=null&&"observers"in s?de(s,n):s.value=n,s.updatedAt=t)}function ue(s,e,t,n=C,o){const r={fn:s,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:h,context:h?h.context:null,pure:t};return h===null||h!==Y&&(h.owned?h.owned.push(r):h.owned=[r]),r}function G(s){if(s.state===0)return;if(s.state===S)return D(s);if(s.suspense&&E(s.suspense.inFallback))return s.suspense.effects.push(s);const e=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<N);)s.state&&e.push(s);for(let t=e.length-1;t>=0;t--)if(s=e[t],s.state===C)$(s);else if(s.state===S){const n=u;u=null,R(()=>D(s,e[0]),!1),u=n}}function R(s,e){if(u)return s();let t=!1;e||(u=[]),x?t=!0:x=[],N++;try{const n=s();return pe(t),n}catch(n){t||(x=null),u=null,X(n)}}function pe(s){if(u&&(j(u),u=null),s)return;const e=x;x=null,e.length&&R(()=>ce(e),!1)}function j(s){for(let e=0;e<s.length;e++)G(s[e])}function D(s,e){s.state=0;for(let t=0;t<s.sources.length;t+=1){const n=s.sources[t];if(n.sources){const o=n.state;o===C?n!==e&&(!n.updatedAt||n.updatedAt<N)&&G(n):o===S&&D(n,e)}}}function q(s){for(let e=0;e<s.observers.length;e+=1){const t=s.observers[e];t.state||(t.state=S,t.pure?u.push(t):x.push(t),t.observers&&q(t))}}function B(s){let e;if(s.sources)for(;s.sources.length;){const t=s.sources.pop(),n=s.sourceSlots.pop(),o=t.observers;if(o&&o.length){const r=o.pop(),i=t.observerSlots.pop();n<o.length&&(r.sourceSlots[i]=n,o[n]=r,t.observerSlots[n]=i)}}if(s.owned){for(e=s.owned.length-1;e>=0;e--)B(s.owned[e]);s.owned=null}if(s.cleanups){for(e=s.cleanups.length-1;e>=0;e--)s.cleanups[e]();s.cleanups=null}s.state=0}function me(s){return s instanceof Error?s:new Error(typeof s=="string"?s:"Unknown error",{cause:s})}function X(s,e=h){throw me(s)}function Q(s,e){return E(()=>s(e||{}))}function ge(s,e,t){let n=t.length,o=e.length,r=n,i=0,l=0,c=e[o-1].nextSibling,a=null;for(;i<o||l<r;){if(e[i]===t[l]){i++,l++;continue}for(;e[o-1]===t[r-1];)o--,r--;if(o===i){const f=r<n?l?t[l-1].nextSibling:t[r-l]:c;for(;l<r;)s.insertBefore(t[l++],f)}else if(r===l)for(;i<o;)(!a||!a.has(e[i]))&&e[i].remove(),i++;else if(e[i]===t[r-1]&&t[l]===e[o-1]){const f=e[--o].nextSibling;s.insertBefore(t[l++],e[i++].nextSibling),s.insertBefore(t[--r],f),e[o]=t[r]}else{if(!a){a=new Map;let p=l;for(;p<r;)a.set(t[p],p++)}const f=a.get(e[i]);if(f!=null)if(l<f&&f<r){let p=i,m=1,y;for(;++p<o&&p<r&&!((y=a.get(e[p]))==null||y!==f+m);)m++;if(m>f-l){const b=e[i];for(;l<f;)s.insertBefore(t[l++],b)}else s.replaceChild(t[l++],e[i++])}else i++;else e[i++].remove()}}}function ye(s,e,t,n={}){let o;return fe(r=>{o=r,e===document?s():Z(e,s(),e.firstChild?null:void 0,t)},n.owner),()=>{o(),e.textContent=""}}function J(s,e,t){let n;const o=()=>{const i=document.createElement("template");return i.innerHTML=s,t?i.content.firstChild.firstChild:i.content.firstChild},r=e?()=>E(()=>document.importNode(n||(n=o()),!0)):()=>(n||(n=o())).cloneNode(!0);return r.cloneNode=r,r}function be(s,e){e==null?s.removeAttribute("class"):s.className=e}function xe(s,e,t){return E(()=>s(e,t))}function Z(s,e,t,n){if(t!==void 0&&!n&&(n=[]),typeof e!="function")return L(s,e,n,t);P(o=>L(s,e(),o,t),n)}function L(s,e,t,n,o){for(;typeof t=="function";)t=t();if(e===t)return t;const r=typeof e,i=n!==void 0;if(s=i&&t[0]&&t[0].parentNode||s,r==="string"||r==="number")if(r==="number"&&(e=e.toString()),i){let l=t[0];l&&l.nodeType===3?l.data!==e&&(l.data=e):l=document.createTextNode(e),t=v(s,t,n,l)}else t!==""&&typeof t=="string"?t=s.firstChild.data=e:t=s.textContent=e;else if(e==null||r==="boolean")t=v(s,t,n);else{if(r==="function")return P(()=>{let l=e();for(;typeof l=="function";)l=l();t=L(s,l,t,n)}),()=>t;if(Array.isArray(e)){const l=[],c=t&&Array.isArray(t);if(_(l,e,t,o))return P(()=>t=L(s,l,t,n,!0)),()=>t;if(l.length===0){if(t=v(s,t,n),i)return t}else c?t.length===0?U(s,l,n):ge(s,t,l):(t&&v(s),U(s,l));t=l}else if(e.nodeType){if(Array.isArray(t)){if(i)return t=v(s,t,n,e);v(s,t,null,e)}else t==null||t===""||!s.firstChild?s.appendChild(e):s.replaceChild(e,s.firstChild);t=e}}return t}function _(s,e,t,n){let o=!1;for(let r=0,i=e.length;r<i;r++){let l=e[r],c=t&&t[s.length],a;if(!(l==null||l===!0||l===!1))if((a=typeof l)=="object"&&l.nodeType)s.push(l);else if(Array.isArray(l))o=_(s,l,c)||o;else if(a==="function")if(n){for(;typeof l=="function";)l=l();o=_(s,Array.isArray(l)?l:[l],Array.isArray(c)?c:[c])||o}else s.push(l),o=!0;else{const f=String(l);c&&c.nodeType===3&&c.data===f?s.push(c):s.push(document.createTextNode(f))}}return o}function U(s,e,t=null){for(let n=0,o=e.length;n<o;n++)s.insertBefore(e[n],t)}function v(s,e,t,n){if(t===void 0)return s.textContent="";const o=n||document.createTextNode("");if(e.length){let r=!1;for(let i=e.length-1;i>=0;i--){const l=e[i];if(o!==l){const c=l.parentNode===s;!r&&!i?c?s.replaceChild(o,l):s.insertBefore(o,t):c&&l.remove()}else r=!0}}else s.insertBefore(o,t);return[o]}const ve="_App_1v6if_1",Ce="_logo_1v6if_9",Ee="_header_1v6if_21",we="_link_1v6if_43",ke={App:ve,logo:Ce,"logo-spin":"_logo-spin_1v6if_1",header:Ee,link:we};var F=(s=>(s[s.Linux=0]="Linux",s[s.Windows=1]="Windows",s[s.Mac=2]="Mac",s))(F||{});const z={BACKSPACE:[{code:8,platform:1}],CAPSLOCK:[{code:20,platform:1}],PAGE_UP:[{code:33,platform:1}],PAGE_DOWN:[{code:34,platform:1}],DELETE:[{code:46,platform:1}],HOME:[{code:36,platform:1}],END:[{code:35,platform:1}],INSERT:[{code:45,platform:1}],PRINT_SCREEN:[{code:44,platform:1}],PAUSE:[{code:19,platform:1}],SELECT_KEY:[{code:93,platform:1}],NUM_LOCK:[{code:144,platform:1}],LEFT_ARROW:[{code:37,platform:1}],RIGHT_ARROW:[{code:39,platform:1}],UP_ARROW:[{code:38,platform:1}],DOWN_ARROW:[{code:40,platform:1}],SPACE:[{code:32,platform:1}],ESCAPE:[{code:27,platform:1}],SHIFT:[{code:16,platform:1}],CTRL:[{code:17,platform:1}],ALT:[{code:18,platform:1}],ENTER:[{code:13,platform:1}],LINE_FEED:[{code:10,platform:1}],TAB:[{code:9,platform:1}],LEFT_WINDOW_KEY:[{code:91,platform:1}],CONTEXT_MENU:[{code:93,platform:1}],SCROLL_LOCK:[{code:145,platform:1}],RIGHT_WINDOW_KEY:[{code:92,platform:1}],F1:[{code:112,platform:1}]};let k;const Ae=new Uint8Array(16);function Se(){if(!k&&(k=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!k))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(Ae)}const d=[];for(let s=0;s<256;++s)d.push((s+256).toString(16).slice(1));function Pe(s,e=0){return d[s[e+0]]+d[s[e+1]]+d[s[e+2]]+d[s[e+3]]+"-"+d[s[e+4]]+d[s[e+5]]+"-"+d[s[e+6]]+d[s[e+7]]+"-"+d[s[e+8]]+d[s[e+9]]+"-"+d[s[e+10]]+d[s[e+11]]+d[s[e+12]]+d[s[e+13]]+d[s[e+14]]+d[s[e+15]]}const Le=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),K={randomUUID:Le};function T(s,e,t){if(K.randomUUID&&!e&&!s)return K.randomUUID();s=s||{};const n=s.random||(s.rng||Se)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let o=0;o<16;++o)e[t+o]=n[o];return e}return Pe(n)}class Ne{id;type;schema;block;constructor({id:e,type:t,block:n,schema:o}){this.id=e||T(),this.type=t,this.schema=o,this.block=n}applyStyling(){const e=this.schema;e?.decorate?.blockClass&&this.block.container.classList.add(e.decorate.blockClass)}removeStyling(){const e=this.schema;e?.decorate?.blockClass&&this.block.container.classList.remove(e.decorate.blockClass)}}function Re(s,e){const t=new Map;return s.forEach(n=>{const o=e(n),r=t.get(o);r?r.push(n):t.set(o,[n])}),t}class A{index;previous;next;text;cache;element;isLineBreak;block;constructor({text:e,block:t}){this.index=0,this.text=e,this.block=t,this.cache={previousOffset:{cy:0,y:0,h:0,x:0,w:0},offset:{cy:0,y:0,h:0,x:0,w:0}},this.isLineBreak=!1,this.element=this.createElement()}createElement(){return this.createSpan()}createSpan(){const e=document.createElement("SPAN");return e.innerText=this.text,e.speedy={cell:this,role:0},e}removeElement(){this.element?.remove()}getTextNode(){let e=this.element?.firstChild;if(!e)return this.element;for(;e?.nodeType!=3;)e=e?.firstChild;return e}}class H{id;type;start;end;isDeleted;cache;value;schema;block;bracket;constructor({type:e,start:t,end:n,block:o,id:r,schema:i}){this.id=r||T(),this.isDeleted=!1,this.type=e,this.start=t,this.end=n,this.schema=i,this.value="",this.block=o,this.cache={},this.bracket={left:void 0,right:void 0}}hasOffsetChanged(){let e=this.start.cache.previousOffset,t=this.start.cache.offset;if(!t||!e||!(e.x==t.x&&e.y==t.y))return!0;let o=this.end.cache.previousOffset,r=this.end.cache.offset;return!o||!r||!(o.x==r.x&&o.y==r.y)}scrollTo(){this.start.element?.scrollIntoView()}applyStyling(){this.schema?.decorate?.cssClass&&this.applyCssClass(this.schema.decorate.cssClass)}applyCssClass(e){if(this.isDeleted)return;this.getCells().forEach(n=>n.element?.classList.add(e))}removeCssClassFromRange(e){if(this.isDeleted)return;this.getCells().forEach(n=>n.element?.classList.remove(e))}getCells(){const e=[];let t=this.start,n=!0;if(this.start==this.end)return e.push(this.start),e;for(;n&&t;){e.push(t);let o=t.next;o||(n=!1),o==this.end&&(e.push(o),n=!1),t=o}return e}showBrackets(){this.bracket.left&&(this.bracket.left.style.display="inline"),this.bracket.right&&(this.bracket.right.style.display="inline")}hideBrackets(){this.bracket.left&&(this.bracket.left.style.display="none"),this.bracket.right&&(this.bracket.right.style.display="none")}}var ee=(s=>(s.Outliner="outliner-block",s.StandoffEditor="standoff-editor-block",s.HTMLEditor="html-editor-block",s.IFrame="iframe-block",s.HTML="html-block",s.PDF="pdf-block",s.Image="image-block",s.Video="video-block",s))(ee||{});class Be{id;type;owner;relations;container;cells;cache;standoffProperties;blockProperties;inputBuffer;schemas;blockSchemas;mode;selections;metadata;overlays;constructor(e,t){this.id=T(),this.owner=e,this.type="standoff-editor-block",this.container=t||document.createElement("DIV"),this.container.setAttribute("contenteditable","true"),this.cache={previousOffset:{x:0,y:0,h:0,w:0},offset:{x:0,y:0,h:0,w:0},verticalArrowNavigation:{lastX:0},containerWidth:0},this.relations={},this.mode={},this.cells=[],this.metadata={},this.schemas=[],this.blockSchemas=[],this.standoffProperties=[],this.blockProperties=[],this.selections=[],this.inputBuffer=[],this.overlays=[],this.attachBindings()}setSchemas(e){this.schemas.push(...e)}setModes(e){for(let t=0;t<e.length;t++){let n=e[t];this.mode={...n}}}addRelation(e,t){this.relations[e]={type:e,sourceId:this.id,targetId:t}}removeRelation(e){delete this.relations[e]}getOrSetOverlay(e){const t=this.overlays.find(n=>n.name==e);return t||this.addOverlay(e)}addOverlay(e){const n=document.createElement("DIV"),o=this.overlays.map(c=>c.index),i=Math.max(...o)+1;n.setAttribute("position","absolute"),n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("z-index",(i+100).toString());const l={name:e,container:n,index:i};return this.overlays.push(l),l}getLastCell(){return this.cells[-1]}removeOverlay(e){const t=this.overlays.find(n=>n.name==e);t&&t.container.remove()}setFocus(){this.container.focus()}getRelation(e){return this.relations[e]}setRelation(e,t){this.relations[e]={type:e,sourceId:this.id,targetId:t}}addKeyboardBinding(e,t){this.mode[e].keyboard.push(t)}addMouseBinding(e,t){this.mode[e].mouse.push(t)}attachBindings(){this.container.addEventListener("keydown",this.handleKeyDown)}createEmptyBlock(){const e=this.createLineBreakCell();this.container.innerHTML="",this.cells=[e];const t=document.createDocumentFragment();this.cells.forEach(n=>t.append(n.element)),this.container.appendChild(t)}getKeyCode(e){return z[e].find(n=>n.platform==F.Windows)?.code}createLineBreakCell(){const e=this.getKeyCode("ENTER"),t=String.fromCharCode(e),n=new A({text:t,block:this});return n.element?.classList.add("line-break"),n}addToInputBuffer(e){if(this.inputBuffer.length<=1){this.inputBuffer.push(e);return}this.inputBuffer.splice(0,1),this.addToInputBuffer(e)}handleKeyDown(e){e.preventDefault();const t=this.toKeyboardInput(e);this.insertCharacterAtCaret(t)}getCellFromNode(e){let t=e;for(;t;){if(t.speedy?.role==0)return this.cells.find(n=>n.element==t);t=t.parentElement}}getBlockPosition(e,t){return t.isLineBreak?e==null?3:2:e==null?1:0}getCaret(){const e=window.getSelection(),{anchorNode:t}=e,n=this.getCellFromNode(t);if(!n)return null;const r=e.anchorOffset==0,i=r?n.previous:n,l=r?n:n.next,c=this.getBlockPosition(i,l);return{left:i,right:l,blockPosition:c}}getEnclosingProperties(e){if(!e)return[];const t=e.index;return this.standoffProperties.filter(o=>{if(o.isDeleted)return!1;const r=o.start.index,i=o.end.index;return r<=t&&t<=i})}getSelection(){const e=window.getSelection()?.getRangeAt(0);if(e?.collapsed)return;const t=this.getCellFromNode(e?.startContainer),n=this.getCellFromNode(e?.endContainer);return{start:t,end:n}}insertCharacterAtCaret(e){const t=this.getCaret();t&&(this.getSelection(),this.insertCharacterAfterIndex(e.key,t.right.index))}insertTextAtIndex(e,t){const n=this.cells[t],o=n.previous,r=o||n,i=e.split("").map(l=>new A({text:l,block:this}));this.knitCells(o,i,n),this.insertIntoCellArrayBefore(n,i),this.insertElementsBefore(n.element,i.map(l=>l.element)),this.updateEnclosingProperties(r)}insertElementsBefore(e,t){const n=document.createDocumentFragment();n.append(...t),requestAnimationFrame(()=>e.insertBefore(n,e))}reindexCells(){this.cells.forEach((e,t)=>e.index=t)}insertIntoCellArrayBefore(e,t){const n=this.cells.findIndex(o=>o==e);this.cells.splice(n,0,...t),this.reindexCells()}knitCells(e,t,n){const o=t.length;if(o!=0)for(let r=0;r<o;r++){let i=t[r],l=r>0?t[r-1]:e,c=r<o-1?t[r+1]:n;l&&(l.next=i,i.previous=l),i.next=c,c.previous=i}}updateEnclosingProperties(e){this.getEnclosingProperties(e)}toKeyboardInput(e){return{shift:e.shiftKey,control:e.ctrlKey,command:e.metaKey,option:e.altKey,key:e.key,keyCode:parseInt(e.code)}}unbind(){const e={};return e.id=this.id,e.text=this.getText(),e.standoffProperties=this.getStandoffPropertiesDto(),e.blockProperties=this.getBlockPropertiesDto(),e}getStandoffPropertiesDto(){return this.standoffProperties.map(t=>({id:t.id,type:t.type,start:t.start.index,end:t.end.index,value:t.value}))}getBlockPropertiesDto(){return this.blockProperties.map(t=>({id:t.id,type:t.type}))}getText(){return this.cells.map(e=>e.text).join()}bind(e){const t=this,n=this.toCells(e.text);this.standoffProperties=e.standoffProperties.map(r=>{const i=n[r.start],l=n[r.end],c=this.schemas.find(f=>f.type==r.type),a=new H({type:r.type,block:t,start:i,end:l,schema:c});return a.value=r.value,a});const o=document.createDocumentFragment();n.forEach(r=>o.append(r.element)),requestAnimationFrame(()=>{this.container.innerHTML="",this.container.appendChild(o)})}getCellAtIndex(e,t){const n=t.length-1;if(!(e>n)&&!(e<0))return t[e]}chainCellsTogether(e){const t=e.length-1,n=t>1;for(let o=0;o<=t;o++){let r=e[o],i=n&&o>0,l=n&&o<t;i&&(e[o-1].next=r,r.previous=e[o-1]),l&&(r.next=e[o+1],e[o+1].previous=r)}}toCells(e){if(!e)return[];const t=e.length,n=[];for(let o=0;o<t;o++){let r=new A({text:e[o],block:this});n.push(r)}return this.chainCellsTogether(n),n}markCells(){this.cells.forEach((e,t)=>e.index=t)}insertCharacterBeforeIndex(e,t){}insertCharacterAfterIndex(e,t){const n=this.cells[t],o=this.cells[t+1];var r=new A({text:e,previous:n,next:o,block:this});return n.next=r,r.previous=n,r.next=o,o.previous=r,r}trigger(e){}removeCell(e){}setCaret(e,t){t=t||0;const o=this.cells[e].getTextNode(),r=document.getSelection(),i=document.createRange();if(i.setStart(o,1),i.collapse(!0),r.setBaseAndExtent){var l=t,c=t;r.setBaseAndExtent(i.startContainer,l,i.endContainer,c)}else r.removeAllRanges(),r.addRange(i)}shiftPropertyBoundaries(e){this.shiftPropertyStartNodesRight(e),this.shiftPropertyEndNodesLeft(e)}shiftPropertyEndNodesLeft(e){const t=e.previous,n=this.standoffProperties.filter(i=>!i.isDeleted),o=n.filter(i=>i.start==i.end&&i.start==e);o&&o.forEach(i=>i.isDeleted=!0);const r=n.filter(i=>i.end==e&&i.start!=e);r.length&&(t?r.forEach(i=>i.end=t):r.forEach(i=>i.isDeleted=!0))}shiftPropertyStartNodesRight(e){const t=e.next,n=this.standoffProperties.filter(i=>!i.isDeleted),o=n.filter(i=>i.start==i.end&&i.start==e);o.length&&o.forEach(i=>i.isDeleted=!0);const r=n.filter(i=>i.start==e&&i.end!=e);r.length&&(t?r.forEach(i=>i.start=t):r.forEach(i=>i.isDeleted=!0))}unknit(e){const t=e.previous,n=e.next;t&&(t.next=n),n.previous=t}updateOffsets(){const e=this;requestAnimationFrame(()=>{e.calculateCellOffsets(),e.cache.verticalArrowNavigation.lastX=null,e.updateRenderers()})}updateRenderers(){const e=this,t=this.standoffProperties.filter(o=>!o.isDeleted&&o.schema?.render?.update&&o.start.cache.offset&&o.hasOffsetChanged());this.batch(t,(o,r)=>o.render?.update({block:e,properties:r}));const n=this.standoffProperties.filter(o=>o.isDeleted&&o.schema?.render?.destroy);this.batch(n,(o,r)=>o.render?.destroy({block:e,properties:r}))}batch(e,t){const n=this;Array.from(Re(e,r=>r.type)).forEach(r=>{const i=r[0],l=r[1],c=n.schemas[i];c&&t(c,l)})}calculateCellOffsets(){const e=this,t=this.container,n=this.cache.offset;this.cache.previousOffset={...n},this.cache.offset={y:t.offsetTop,x:t.offsetLeft,w:t.offsetWidth,h:t.offsetHeight},this.cells.forEach(o=>{const r=o.cache.offset,i=e.cache.offset.y;r&&(o.cache.previousOffset={...r});const l=o.element;if(!l)return;const c=l.offsetTop||0;o.cache.offset={y:c,cy:i+c,x:l.offsetLeft,w:l.offsetWidth,h:l.offsetHeight}})}removeCellAtIndex(e,t){const n=this.cells[e];t=!!t,!n.isLineBreak&&(this.unknit(n),n.removeElement(),this.cells.splice(e,1),this.reindexCells(),this.updateEnclosingProperties(n),t&&this.setCaret(e))}getCells(e){const t=[];let n=e.start;for(;n;){t.push(n),n.next&&!n.isLineBreak&&(n=n.next);break}return t}styleProperty(e){e.applyStyling()}createStandoffProperty(e,t){const n=this.schemas.find(r=>r.type==e);if(!n){V(`StandoffProperty schema '${e}' was not found.`,{block:this,type:e,range:t});return}const o=new H({type:e,block:this,...t,schema:n});return o.schema=n,o.applyStyling(),this.standoffProperties.push(o),o}createBlockProperty(e){const t=this.blockSchemas.find(o=>o.type==e);if(!t){V(`BlockProperty schema '${e}' was not found.`,{block:this,type:e});return}const n=new Ne({type:e,block:this,schema:t});return this.blockProperties.push(n),n.applyStyling(),n}syncPropertyEndToText(){}unsynchPropertyEndToText(){}}const V=(s,e)=>{console.log(s,e)},Te=s=>{var e=document.createElementNS("http://www.w3.org/2000/svg","svg");return W(e,s)},W=(s,e)=>{if(e.property&&(s.property=e.property),e.attribute)for(var t in e.attribute)t.indexOf("xlink")<0?s.setAttributeNS(null,t,e.attribute[t]):s.setAttribute(t,e.attribute[t]);if(e.style)for(var t in e.style){var n=e.style[t];s.style[t]=n}return e.children&&e.children.forEach(o=>s.appendChild(o)),s};function Oe(s,e){const t=new Map;return s.forEach(n=>{const o=e(n),r=t.get(o);r?r.push(n):t.set(o,[n])}),t}const Ie=(s,e)=>{e.offsetY=typeof e.offsetY>"u"?3:e.offsetY,s.cache.underline&&s.cache.underline.remove();const t=s.getCells();if(t.length==0)return;const o=Array.from(Oe(t,y=>y.cache.offset.y)).sort((y,b)=>y[0]>b[0]?1:y[0]<b[0]?-1:0),r=t.length-1,i=t[0].cache.offset.y,l=t[r].cache.offset.y,c=t[r].cache.offset.h,a=e.containerWidth,f=l+c-i+10,p=s.cache.underline=Te({style:{position:"absolute",left:0,top:i+"px",width:a+"px",height:f+"px","pointer-events":"none"}}),m=o.map(y=>{const b=y[1],te=b.length=1,se=b[0],ne=b[te],w=se.cache.offset,O=ne.cache.offset,oe=w.x,re=w.y+w.h-i+e.offsetY,ie=O.x+O.w,le=O.y+w.h-i+e.offsetY;var M=De({style:{stroke:e.stroke||"blue",strokeWidth:e.strokeWidth||"2"},x1:oe,y1:re,x2:ie,y2:le});return e.strokeOpacity&&W(M,{style:{strokeOpacity:e.strokeOpacity}}),M});return p.append(...m),p},De=s=>{var e=document.createElementNS("http://www.w3.org/2000/svg","line");return W(e,s)};class _e{id;type;container;relations;blocks;metadata;focus;selections;constructor(e){this.id=e?.id||T(),this.type=ee.Outliner,this.container=e?.container||document.createElement("DIV"),this.relations={},this.blocks=[],this.metadata={},this.selections=[]}addRelation(e){}removeRelation(e){}setFocus(){}setBlockFocus(e){this.focus=e,e.setFocus()}getBlockSchemas(){return[{type:"block/alignment/centre",decorate:{blockClass:"block_alignment_centre"},bindings:["control-a","control-c"],bindingHandler:e=>{e.createBlockProperty("style/alignment/centre")}}]}getStandoffSchemas(){return[{type:"style/italics",bindings:["control-i"],bindingHandler:(e,t)=>{t&&e.createStandoffProperty("style/italics",t)},decorate:{cssClass:"style_italics"}},{type:"style/bold",bindings:["control-b"],bindingHandler:(e,t)=>{t&&e.createStandoffProperty("style/bold",t)},decorate:{cssClass:"style_bold"}},{type:"codex/entity-reference",bindings:["control-e","control-f"],bindingHandler:async(e,t)=>{},render:{destroy:({properties:e})=>{e.forEach(t=>t.cache.underline?.remove())},update:e=>{const{block:t,properties:n}=e,o=t.getOrSetOverlay("codex/entity-reference"),r=t.cache.containerWidth,i=n.map(c=>Ie(c,{stroke:"purple",containerWidth:r,offsetY:3})),l=document.createDocumentFragment();l.append(...i),o.container.appendChild(l)}}}]}getPlatformKey(e){return e.find(t=>t.platform==F.Windows)}getBlock(e){return this.blocks.find(t=>t.id==e)}getModes(){const e=this,t=[];return t.push({default:{keyboard:[{DELETE:n=>{const{block:o,caret:r}=n;if(!r.left){o.trigger("DELETE_CHARACTER_FROM_START_OF_BLOCK");return}o.removeCellAtIndex(r.left.index,!0)},"LEFT-ARROW":n=>{const{block:o,caret:r}=n;if(r.left){o.setCaret(r.left.index);return}const i=o.getRelation("has-previous-sibling");if(!i)return;const l=e.getBlock(i.targetId);if(!l)return;const c=l.getLastCell();l.setCaret(c.index),e.setBlockFocus(l)},HOME:n=>{const{block:o}=n,r=o.cells[0];o.setCaret(r.index)},END:n=>{const{block:o}=n,{cells:r}=o,i=r[-1];o.setCaret(i.index)},TAB:n=>{const{block:o,caret:r}=n,i=r.right.index;o.insertTextAtIndex("    ",i)},ENTER:n=>{const{block:o}=n,r=e.createNewBlock(),i=o.getRelation("next");o.setRelation("next",r.id),r.setRelation("previous",o.id),i&&r.setRelation("next",i.targetId),e.appendSibling(o.container,r.container),e.setBlockFocus(r)},"shift-ENTER":n=>{const{block:o,caret:r}=n,i=r.right.index,l=e.getPlatformKey(z.ENTER).code;o.insertCharacterAfterIndex(String.fromCharCode(l),i).element?.classList.add("codex__line-break")}}],mouse:[]},"nested-list":{keyboard:[{TAB:n=>{const{block:o}=n,r=e.createNewBlock();e.indent(o,r)}}],mouse:[]}}),t}loadDocument(e){const t=this.getStandoffSchemas();this.getBlockSchemas();const n=this.getModes(),o=document.createElement("DIV"),r=e.text.split(/\r?\n/);let i=0;for(let l=0;l<r.length;l++){let c=this.createNewBlock();c.setSchemas(t),c.setModes(n);let a=r[l],f=i+a.length+1;const p=e.standoffProperties.filter(m=>m.start!=null&&m.end!=null).filter(m=>m.start>=i&&m.end<=f);i+=a.length,c.bind({text:a,standoffProperties:p}),o.appendChild(c.container)}}undent(e){const t=e.relations["child-of"];if(!t)return;const n=this.blocks.find(i=>i.id==t.targetId);if(!n)return;n.removeRelation("parent-of"),e.removeRelation("child-of");const o=n;o.addRelation("followed-by",e.id),e.addRelation("follows",o.id);const r=e.metadata.indentLevel;e.metadata.indentLevel=r-1,this.renderIndent(e)}indent(e,t){t.addRelation("child-of",e.id),e.addRelation("parent-of",t.id);const n=e.metadata.indentLevel;t.metadata.indentLevel=n+1,this.renderIndent(t)}renderIndent(e){const n=e.metadata.indentLevel;e.container.setAttribute("margin-left",n*20+"px")}createNewBlock(){return new Be(this)}appendSibling(e,t){e.insertAdjacentElement("afterend",t)}startNewDocument(){}}var Fe=J("<div>");const We=s=>{const e=t=>{const n={text:"Once upon a midnight dreary ...",standoffProperties:[{type:"style/italics",start:5,end:9},{type:"style/bold",start:7,end:14}]},o=new _e;o.container=t,o.loadDocument(n)};return(()=>{var t=Fe();return xe(e,t),t})()};var Me=J("<div>");const Ue=()=>(()=>{var s=Me();return Z(s,Q(We,{})),P(()=>be(s,ke.App)),s})(),Ke=document.getElementById("root");ye(()=>Q(Ue,{}),Ke);
